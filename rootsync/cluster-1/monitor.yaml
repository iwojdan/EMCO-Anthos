---
# Source: monitor/templates/serviceaccount.yaml
# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation
apiVersion: v1
kind: ServiceAccount
metadata:
  name: monitor
  namespace: emco
---
# Source: monitor/templates/secret.yml
apiVersion: v1
kind: Secret
metadata:
  name: emco-git-monitor
  namespace: emco
type: Opaque
data:
  username: "aXdvamRhbg=="
  token: "Z2hwX1pnRW01UXMxZmpaeUlwdmlKMDJLMTlhS2ZzTE9YOTAzbTlvMg=="
  repo: "RU1DTy1BbnRob3M="
  clustername: "cHJvdmlkZXItYW50aG9zK2NsdXN0ZXIy"
---
# Source: monitor/templates/configmap.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: emco-monitor-list
  namespace: emco
data:
  gvk.conf: |
      [
        {"Group": "k8s.plugin.opnfv.org", "Version": "v1alpha1", "Kind": "Network", "Resource": "networks" },
        {"Group": "rbac.authorization.k8s.io", "Version": "v1", "Kind": "ClusterRole", "Resource": "clusterroles"},
        {"Group": "cert-manager.io", "Version": "v1", "Kind": "CertificateRequest", "Resource": "certificaterequests"},
        {"Group": "networking.istio.io", "Version": "v1beta1", "Kind": "ProxyConfig", "Resource": "proxyconfigs"},
        {"Group": "cert-manager.io", "Version": "v1", "Kind": "ClusterIssuer", "Resource": "clusterissuers"}
      ]
---
# Source: monitor/templates/customresourcedefinition.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.7.0
  creationTimestamp: null
  name: resourcebundlestates.k8splugin.io
spec:
  group: k8splugin.io
  names:
    kind: ResourceBundleState
    listKind: ResourceBundleStateList
    plural: resourcebundlestates
    singular: resourcebundlestate
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            type: string
          kind:
            type: string
          metadata:
            type: object
          spec:
            properties:
              selector:
                properties:
                  matchExpressions:
                    items:
                      properties:
                        key:
                          type: string
                        operator:
                          type: string
                        values:
                          items:
                            type: string
                          type: array
                      required:
                      - key
                      - operator
                      type: object
                    type: array
                  matchLabels:
                    additionalProperties:
                      type: string
                    type: object
                type: object
            required:
            - selector
            type: object
          
---
# Source: monitor/templates/clusterrole.yaml
# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: monitor
rules:
- apiGroups:
  - ""
  resources:
  - pods
  - services
  - endpoints
  - persistentvolumeclaims
  - events
  - configmaps
  - secrets
  verbs:
  - '*'
- apiGroups:
  - apps
  resources:
  - deployments
  - daemonsets
  - replicasets
  - statefulsets
  verbs:
  - '*'
- apiGroups:
  - monitoring.coreos.com
  resources:
  - servicemonitors
  verbs:
  - get
  - create
- apiGroups:
  - apps
  resourceNames:
  - monitor
  resources:
  - deployments/finalizers
  verbs:
  - update
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
- apiGroups:
  - apps
  resources:
  - replicasets
  verbs:
  - get
- apiGroups:
  - k8splugin.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - batch
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - extensions
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - certificates.k8s.io
  resources:
  - '*'
  verbs:
  - '*'
---
# Source: monitor/templates/clusterrolebinding.yaml
# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: monitor
subjects:
- kind: ServiceAccount
  name: monitor
  namespace: emco
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
---
# Source: monitor/templates/deployment.yaml
# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2020 Intel Corporation
apiVersion: apps/v1
kind: Deployment
metadata:
  name: emco-monitor
  namespace: emco
spec:
  replicas: 1
  selector:
    matchLabels:
      app: monitor
  template:
    metadata:
      labels:
        app: monitor
    spec:
      serviceAccountName: monitor
      containers:
        - name: monitor
          # Replace this with the built image name
          #image: emcov2/monitor:latest
          image: registry.gitlab.com/project-emco/core/emco-base/emco-monitor:22.06
          command:
          - /opt/emco/monitor/monitor
          imagePullPolicy: Always
          volumeMounts:
          - name: config-volume
            mountPath: /opt/emco/monitor/gvk.conf
            subPath: gvk.conf
          env:
            - name: NO_PROXY
              value: 
            - name: no_proxy
              value: 
            - name: http_proxy
              value: 
            - name: https_proxy
              value: 
            - name: HTTP_PROXY
              value: 
            - name: HTTPS_PROXY
              value: 
            - name: WATCH_NAMESPACE
              value: ""
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: OPERATOR_NAME
              value: "monitor"
            - name: GIT_USERNAME
              valueFrom:
                secretKeyRef:
                  name: emco-git-monitor
                  key: username
            - name: GIT_TOKEN
              valueFrom:
                secretKeyRef:
                  name: emco-git-monitor
                  key: token
            - name: GIT_REPO
              valueFrom:
                secretKeyRef:
                  name: emco-git-monitor
                  key: repo
            - name: GIT_CLUSTERNAME
              valueFrom:
                secretKeyRef:
                  name: emco-git-monitor
                  key: clustername
      volumes:
      - name: config-volume
        configMap:
          name: emco-monitor-list
